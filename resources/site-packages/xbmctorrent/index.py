from xbmctorrent import plugin, magnet, scrapers
from xbmctorrent.ga import tracked
from xbmctorrent.utils import ensure_fanart
from xbmctorrent.scrapers import \
    MODULES, \
    eztv, \
    yify, \
    kickass, \
    tpb


@plugin.route("/")
@ensure_fanart
@tracked(force=True)
def index():
    import os
    firstrun = os.path.join(plugin.addon.getAddonInfo("path"), ".firstrun")
    if not os.path.exists(firstrun):
        with open(firstrun, "w"):
            # This doesn't get set properly
            plugin.set_setting("encryption", "1")
            plugin.open_settings()

    for module in MODULES:
        yield {
            "label": module["name"],
            "thumbnail": module["image"],
            "path": plugin.url_for(module["view"]),
        }
