import os
import stat
import subprocess
from xbmctorrent.common import BIN_PATH

def ensure_exec_perms(file_):
    st = os.stat(file_)
    os.chmod(file_, st.st_mode | stat.S_IEXEC)
    return file_

def start(**kwargs):
    args = [ensure_exec_perms(os.path.join(BIN_PATH, "torrent2http"))]
    for k, v in kwargs.items():
        args.append("--%s" % k)
        args.append(v)

    import xbmc
    xbmc.log(repr(args))
    return subprocess.Popen(args, cwd=BIN_PATH)
