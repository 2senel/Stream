from xbmctorrent.plugin import plugin


PUBLIC_TRACKERS = [
    "udp://open.demonii.com:1337/announce",
    "udp://tracker.publicbt.com:80/announce",
    "udp://tracker.openbittorrent.com:80/announce",
    "udp://tracker.istole.it:80/announce",
    "udp://tracker.ccc.de:80",
]


# Add default trackers to a magnet link, to improve its reachability
def _boost_magnet(magnet):
    from urllib import urlencode
    return "%s&%s" % (magnet, urlencode({"tr": PUBLIC_TRACKERS}, True))


@plugin.route("/play/<magnet>")
def play(magnet):
    from xbmctorrent.player import TorrentPlayer
    if plugin.get_setting("magnet_boost", bool):
        plugin.log.info("Enabled magnet booster")
        magnet = _boost_magnet(magnet)
    TorrentPlayer().init(magnet).loop()
